
const testsData = {
  variant1: {
    title: "Вариант 1. Основной тест по интегралам",
    questions: [
      {
        id: 1,
        question: "Что такое определённый интеграл?",
        choices: [
          "Предел суммы Римана при разбиении отрезка",
          "Метод нахождения первообразной",
          "Сумма бесконечно малых изменений функции",
          "Площадь области под кривой"
        ],
        answer: 0
      },
      {
        id: 2,
        question: "Какое свойство интеграла позволяет разделить интеграл по [a, b] на отрезки [a, c] и [c, b]?",
        choices: [
          "Линейность",
          "Аддитивность по промежутку",
          "Монотонность",
          "Дифференцируемость"
        ],
        answer: 1
      },
      {
        id: 3,
        question: "Что такое первообразная функции?",
        choices: [
          "Функция, производная которой равна данной функции",
          "Интеграл функции",
          "Обратная функция",
          "Функция, равная постоянной"
        ],
        answer: 0
      },
      {
        id: 4,
        question: "Какой метод используется для вычисления интеграла сложной функции?",
        choices: [
          "Метод интегрирования по частям",
          "Метод подстановки",
          "Метод деления",
          "Метод вероятностей"
        ],
        answer: 1
      },
      {
        id: 5,
        question: "Что означает линейность интеграла?",
        choices: [
          "Интеграл суммы равен сумме интегралов",
          "Интеграл произведения равен произведению интегралов",
          "Интеграл функции равен функции интеграла",
          "Интеграл константы равен нулю"
        ],
        answer: 0
      },
      {
        id: 6,
        question: "Какова роль теоремы Фундамента в интегральном исчислении?",
        choices: [
          "Связывает дифференцирование и интегрирование",
          "Обеспечивает правило замены переменной",
          "Гарантирует существование интеграла",
          "Делит область интегрирования"
        ],
        answer: 0
      },
      {
        id: 7,
        question: "Что является интерпретацией определённого интеграла в геометрии?",
        choices: [
          "Длина участка кривой",
          "Площадь под графиком",
          "Объём тела",
          "Центр масс"
        ],
        answer: 1
      },
      {
        id: 8,
        question: "При каких условиях выполняется теорема о среднем значении интеграла?",
        choices: [
          "Функция непрерывна на [a, b]",
          "Функция дифференцируема на [a, b]",
          "Функция равна нулю",
          "Функция ограничена"
        ],
        answer: 0
      },
      {
        id: 9,
        question: "Что такое неопределённый интеграл?",
        choices: [
          "Функция, производная которой равна данной, плюс константа",
          "Интеграл без указания пределов",
          "Интеграл с неопределёнными пределами",
          "Предел сумм Римана"
        ],
        answer: 0
      },
      {
        id: 10,
        question: "Какой принцип лежит в основе интегрирования по частям?",
        choices: [
          "Замена переменной",
          "Правило произведения для производных",
          "Правило суммы",
          "Элементарная функция"
        ],
        answer: 1
      }
    ]
  },
  variant2: {
    title: "Вариант 2. Дополнительный тест по интегралам",
    questions: [
      {
        id: 1,
        question: "Что иллюстрирует определённый интеграл?",
        choices: [
          "Площадь области под графиком",
          "Объём тела",
          "Длину дуги",
          "Предел суммы Римана"
        ],
        answer: 0
      },
      {
        id: 2,
        question: "Что такое первообразная функции?",
        choices: [
          "Функция, производная которой равна исходной",
          "Функция-решение дифференциального уравнения",
          "Результат интегрирования",
          "Функция, обратная исходной"
        ],
        answer: 0
      },
      {
        id: 3,
        question: "Какой метод упрощает вычисление сложных интегралов?",
        choices: [
          "Метод интегрирования по частям",
          "Метод подстановки",
          "Метод деления",
          "Метод экстраполяции"
        ],
        answer: 1
      },
      {
        id: 4,
        question: "Что означает свойство монотонности интеграла?",
        choices: [
          "Если функция неотрицательна, интеграл неотрицателен",
          "Интеграл суммы равен сумме интегралов",
          "Интеграл произведения равен произведению интегралов",
          "Ничего из перечисленного"
        ],
        answer: 0
      },
      {
        id: 5,
        question: "Как вычисляется интеграл функции, равной константе?",
        choices: [
          "Константа умноженная на длину интервала",
          "Константа плюс длина интервала",
          "Неверно",
          "Константа возводится в степень"
        ],
        answer: 0
      },
      {
        id: 6,
        question: "Какую роль играет аддитивность в интегральном исчислении?",
        choices: [
          "Разделение интервала интегрирования",
          "Сложение функций",
          "Объединение пределов",
          "Умножение интегралов"
        ],
        answer: 0
      },
      {
        id: 7,
        question: "Что показывает теорема Фундамента анализа?",
        choices: [
          "Связь интегрирования и дифференцирования",
          "Замена переменной",
          "Метод частного дифференцирования",
          "Интегральное уравнение"
        ],
        answer: 0
      },
      {
        id: 8,
        question: "Как называется интеграл без указания пределов интегрирования?",
        choices: [
          "Неопределённый интеграл",
          "Определённый интеграл",
          "Локализованный интеграл",
          "Инфинитезимальный интеграл"
        ],
        answer: 0
      },
      {
        id: 9,
        question: "Какова геометрическая интерпретация определённого интеграла?",
        choices: [
          "Площадь под кривой",
          "Объём твердого тела",
          "Длина линии",
          "Угловая мера"
        ],
        answer: 0
      },
      {
        id: 10,
        question: "Что позволяет применять метод интегрирования по частям?",
        choices: [
          "Выделить сложное произведение функций",
          "Найти первообразную",
          "Разделить интеграл на две части",
          "Определить константу интегрирования"
        ],
        answer: 0
      }
    ]
  },
    variant3: {
    title: "Вариант 3. Основной тест по интегралам",
    questions: [
      {
        id: 1,
        question: "Что такое определённый интеграл?",
        choices: [
          "Предел суммы Римана при разбиении отрезка",
          "Метод нахождения первообразной",
          "Сумма бесконечно малых изменений функции",
          "Площадь области под кривой"
        ],
        answer: 0
      },
      {
        id: 2,
        question: "Какое свойство интеграла позволяет разделить интеграл по [a, b] на отрезки [a, c] и [c, b]?",
        choices: [
          "Линейность",
          "Аддитивность по промежутку",
          "Монотонность",
          "Дифференцируемость"
        ],
        answer: 1
      },
      {
        id: 3,
        question: "Что такое первообразная функции?",
        choices: [
          "Функция, производная которой равна данной функции",
          "Интеграл функции",
          "Обратная функция",
          "Функция, равная постоянной"
        ],
        answer: 0
      },
      {
        id: 4,
        question: "Какой метод используется для вычисления интеграла сложной функции?",
        choices: [
          "Метод интегрирования по частям",
          "Метод подстановки",
          "Метод деления",
          "Метод вероятностей"
        ],
        answer: 1
      },
      {
        id: 5,
        question: "Что означает линейность интеграла?",
        choices: [
          "Интеграл суммы равен сумме интегралов",
          "Интеграл произведения равен произведению интегралов",
          "Интеграл функции равен функции интеграла",
          "Интеграл константы равен нулю"
        ],
        answer: 0
      },
      {
        id: 6,
        question: "Какова роль теоремы Фундамента в интегральном исчислении?",
        choices: [
          "Связывает дифференцирование и интегрирование",
          "Обеспечивает правило замены переменной",
          "Гарантирует существование интеграла",
          "Делит область интегрирования"
        ],
        answer: 0
      },
      {
        id: 7,
        question: "Что является интерпретацией определённого интеграла в геометрии?",
        choices: [
          "Длина участка кривой",
          "Площадь под графиком",
          "Объём тела",
          "Центр масс"
        ],
        answer: 1
      },
      {
        id: 8,
        question: "При каких условиях выполняется теорема о среднем значении интеграла?",
        choices: [
          "Функция непрерывна на [a, b]",
          "Функция дифференцируема на [a, b]",
          "Функция равна нулю",
          "Функция ограничена"
        ],
        answer: 0
      },
      {
        id: 9,
        question: "Что такое неопределённый интеграл?",
        choices: [
          "Функция, производная которой равна данной, плюс константа",
          "Интеграл без указания пределов",
          "Интеграл с неопределёнными пределами",
          "Предел сумм Римана"
        ],
        answer: 0
      },
      {
        id: 10,
        question: "Какой принцип лежит в основе интегрирования по частям?",
        choices: [
          "Замена переменной",
          "Правило произведения для производных",
          "Правило суммы",
          "Элементарная функция"
        ],
        answer: 1
      }
    ]
  },
    variant4: {
    title: "Вариант 4. Основной тест по интегралам",
    questions: [
      {
        id: 1,
        question: "Что такое определённый интеграл?",
        choices: [
          "Предел суммы Римана при разбиении отрезка",
          "Метод нахождения первообразной",
          "Сумма бесконечно малых изменений функции",
          "Площадь области под кривой"
        ],
        answer: 0
      },
      {
        id: 2,
        question: "Какое свойство интеграла позволяет разделить интеграл по [a, b] на отрезки [a, c] и [c, b]?",
        choices: [
          "Линейность",
          "Аддитивность по промежутку",
          "Монотонность",
          "Дифференцируемость"
        ],
        answer: 1
      },
      {
        id: 3,
        question: "Что такое первообразная функции?",
        choices: [
          "Функция, производная которой равна данной функции",
          "Интеграл функции",
          "Обратная функция",
          "Функция, равная постоянной"
        ],
        answer: 0
      },
      {
        id: 4,
        question: "Какой метод используется для вычисления интеграла сложной функции?",
        choices: [
          "Метод интегрирования по частям",
          "Метод подстановки",
          "Метод деления",
          "Метод вероятностей"
        ],
        answer: 1
      },
      {
        id: 5,
        question: "Что означает линейность интеграла?",
        choices: [
          "Интеграл суммы равен сумме интегралов",
          "Интеграл произведения равен произведению интегралов",
          "Интеграл функции равен функции интеграла",
          "Интеграл константы равен нулю"
        ],
        answer: 0
      },
      {
        id: 6,
        question: "Какова роль теоремы Фундамента в интегральном исчислении?",
        choices: [
          "Связывает дифференцирование и интегрирование",
          "Обеспечивает правило замены переменной",
          "Гарантирует существование интеграла",
          "Делит область интегрирования"
        ],
        answer: 0
      },
      {
        id: 7,
        question: "Что является интерпретацией определённого интеграла в геометрии?",
        choices: [
          "Длина участка кривой",
          "Площадь под графиком",
          "Объём тела",
          "Центр масс"
        ],
        answer: 1
      },
      {
        id: 8,
        question: "При каких условиях выполняется теорема о среднем значении интеграла?",
        choices: [
          "Функция непрерывна на [a, b]",
          "Функция дифференцируема на [a, b]",
          "Функция равна нулю",
          "Функция ограничена"
        ],
        answer: 0
      },
      {
        id: 9,
        question: "Что такое неопределённый интеграл?",
        choices: [
          "Функция, производная которой равна данной, плюс константа",
          "Интеграл без указания пределов",
          "Интеграл с неопределёнными пределами",
          "Предел сумм Римана"
        ],
        answer: 0
      },
      {
        id: 10,
        question: "Какой принцип лежит в основе интегрирования по частям?",
        choices: [
          "Замена переменной",
          "Правило произведения для производных",
          "Правило суммы",
          "Элементарная функция"
        ],
        answer: 1
      }
    ]
  },
    variant5: {
    title: "Вариант 5. Основной тест по интегралам",
    questions: [
      {
        id: 1,
        question: "Что такое определённый интеграл?",
        choices: [
          "Предел суммы Римана при разбиении отрезка",
          "Метод нахождения первообразной",
          "Сумма бесконечно малых изменений функции",
          "Площадь области под кривой"
        ],
        answer: 0
      },
      {
        id: 2,
        question: "Какое свойство интеграла позволяет разделить интеграл по [a, b] на отрезки [a, c] и [c, b]?",
        choices: [
          "Линейность",
          "Аддитивность по промежутку",
          "Монотонность",
          "Дифференцируемость"
        ],
        answer: 1
      },
      {
        id: 3,
        question: "Что такое первообразная функции?",
        choices: [
          "Функция, производная которой равна данной функции",
          "Интеграл функции",
          "Обратная функция",
          "Функция, равная постоянной"
        ],
        answer: 0
      },
      {
        id: 4,
        question: "Какой метод используется для вычисления интеграла сложной функции?",
        choices: [
          "Метод интегрирования по частям",
          "Метод подстановки",
          "Метод деления",
          "Метод вероятностей"
        ],
        answer: 1
      },
      {
        id: 5,
        question: "Что означает линейность интеграла?",
        choices: [
          "Интеграл суммы равен сумме интегралов",
          "Интеграл произведения равен произведению интегралов",
          "Интеграл функции равен функции интеграла",
          "Интеграл константы равен нулю"
        ],
        answer: 0
      },
      {
        id: 6,
        question: "Какова роль теоремы Фундамента в интегральном исчислении?",
        choices: [
          "Связывает дифференцирование и интегрирование",
          "Обеспечивает правило замены переменной",
          "Гарантирует существование интеграла",
          "Делит область интегрирования"
        ],
        answer: 0
      },
      {
        id: 7,
        question: "Что является интерпретацией определённого интеграла в геометрии?",
        choices: [
          "Длина участка кривой",
          "Площадь под графиком",
          "Объём тела",
          "Центр масс"
        ],
        answer: 1
      },
      {
        id: 8,
        question: "При каких условиях выполняется теорема о среднем значении интеграла?",
        choices: [
          "Функция непрерывна на [a, b]",
          "Функция дифференцируема на [a, b]",
          "Функция равна нулю",
          "Функция ограничена"
        ],
        answer: 0
      },
      {
        id: 9,
        question: "Что такое неопределённый интеграл?",
        choices: [
          "Функция, производная которой равна данной, плюс константа",
          "Интеграл без указания пределов",
          "Интеграл с неопределёнными пределами",
          "Предел сумм Римана"
        ],
        answer: 0
      },
      {
        id: 10,
        question: "Какой принцип лежит в основе интегрирования по частям?",
        choices: [
          "Замена переменной",
          "Правило произведения для производных",
          "Правило суммы",
          "Элементарная функция"
        ],
        answer: 1
      }
    ]
  },
};
const variantBlockId = 'variantSelection';
let currentTest;
let currentQuestionIndex = 0;
let score = 0;
let userAnswers = [];

function startTest(variant) {
  currentTest = testsData[variant];
  currentQuestionIndex = 0;
  score = 0;
  userAnswers = [];
  document.getElementById('variant-selection').style.display = 'none';
  document.getElementById('heroSection').classList.add('d-none');
  document.getElementById('test-container').style.display = 'block';
  showQuestion();
}

function showQuestion() {
  const testContainer = document.getElementById('test-container');
  const currentQuestion = currentTest.questions[currentQuestionIndex];
  const total = currentTest.questions.length;
  const current = currentQuestionIndex + 1;
  const percent = Math.round((currentQuestionIndex / total) * 100);


  let html = `
    <div class="card mx-auto p-4 shadow-sm animate-fade" style="max-width: 800px;">
      <div class="mb-3">
        <button type="button" class="btn btn-outline-secondary btn-sm" onclick="backToVariants()">← Назад к выбору вариантов</button>
      </div>
      <h4 class="mb-1">${currentTest.title}</h4>
      <div class="text-muted mb-3">Вопрос ${current} из ${total}</div>

      <div class="progress mb-3">
        <div class="progress-bar bg-info" role="progressbar" style="width: ${percent}%;" aria-valuenow="${percent}" aria-valuemin="0" aria-valuemax="100">${percent}%</div>
      </div>

      <form id="questionForm">
        <div class="mb-4">
          <p class="fw-bold">${currentQuestion.question}</p>`;

  currentQuestion.choices.forEach((choice, cIndex) => {
    const radioId = `q${currentQuestionIndex}_choice${cIndex}`;
    const checked = userAnswers[currentQuestionIndex] === cIndex ? "checked" : "";
    html += `
      <div class="form-check mb-2">
        <input class="form-check-input" type="radio" name="answer" id="${radioId}" value="${cIndex}" ${checked}>
        <label class="form-check-label" for="${radioId}">${choice}</label>
      </div>`;
  });

  html += `</div><div class="d-flex justify-content-between">`;

  if (currentQuestionIndex > 0) {
    html += `<button type="button" class="btn btn-outline-secondary" onclick="prevQuestion()">← Назад</button>`;
  } else {
    html += `<div></div>`;
  }


  html += `<button type="submit" class="btn btn-primary">${current < total ? "Далее →" : "Завершить тест"}</button>`;
  html += `</div></form></div>`;

  testContainer.innerHTML = html;
  document.getElementById('questionForm').addEventListener('submit', handleNext);
}

function handleNext(event) {
  event.preventDefault();
  const selected = document.querySelector('input[name="answer"]:checked');
  if (!selected) {
    alert('Пожалуйста, выберите ответ');
    return;
  }

  const answer = parseInt(selected.value);
  userAnswers[currentQuestionIndex] = answer;

  if (answer === currentTest.questions[currentQuestionIndex].answer) {
    score++;
  }

  currentQuestionIndex++;
  if (currentQuestionIndex < currentTest.questions.length) {
    showQuestion();
  } else {
    showResults();
  }
}

function prevQuestion() {
  if (currentQuestionIndex > 0) {
    currentQuestionIndex--;
    showQuestion();
  }
}

function showResults() {
  const testContainer = document.getElementById('test-container');
  let html = `
    <div class="card mx-auto p-4 shadow-sm animate-fade" style="max-width: 800px;">
      <button type="button" class="btn btn-outline-secondary mb-3" onclick="backToVariants()">← Назад к выбору вариантов</button>
      <h3 class="mb-4">Результаты теста</h3>
      <div class="alert alert-info">Ваш результат: ${score} из ${currentTest.questions.length}</div>
      <div class="mt-4"><h5>Ошибки:</h5>`;

  let incorrectExists = false;
  currentTest.questions.forEach((q, index) => {
    if (userAnswers[index] !== q.answer) {
      incorrectExists = true;
      const userChoice = (userAnswers[index] !== undefined) ? q.choices[userAnswers[index]] : "Без ответа";
      const correctChoice = q.choices[q.answer];

      html += `
        <div class="card mb-3">
          <div class="card-body">
            <p><strong>Вопрос ${index + 1}:</strong> ${q.question}</p>
            <p><strong>Ваш ответ:</strong> ${userChoice}</p>
            <p><strong>Правильный ответ:</strong> ${correctChoice}</p>
          </div>
        </div>`;
    }
  });

  if (!incorrectExists) {
    html += `<p>Поздравляем, все ответы верны!</p>`;
  }

  html += `</div></div>`;
  testContainer.innerHTML = html;
}

function backToVariants() {
  document.getElementById('test-container').style.display = 'none';
  document.getElementById('variant-selection').style.display = 'block';
  document.getElementById('heroSection').classList.remove('d-none');
}